<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test SPA 2 - Storage XSS</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 900px; margin: 50px auto; padding: 20px; }
        .section { background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 5px; }
        input, textarea { width: 100%; padding: 10px; margin: 10px 0; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; cursor: pointer; margin: 5px; }
        .output { background: white; padding: 15px; border: 1px solid #ddd; margin-top: 15px; }
        .warning { background: #fff3cd; padding: 10px; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>üî¨ Test SPA 2 - Storage-based XSS</h1>
    <p>Diese Test-SPA enth√§lt Storage-basierte DOM XSS Schwachstellen.</p>
    
    <div class="section">
        <h2>üìù Notes (localStorage)</h2>
        <textarea id="noteInput" rows="4" placeholder="Enter your note..."></textarea>
        <button onclick="saveNote()">Save to localStorage</button>
        <button onclick="loadNotes()">Load Notes</button>
        <button onclick="clearNotes()">Clear</button>
        <div id="notesOutput" class="output"></div>
    </div>
    
    <div class="section">
        <h2>‚öôÔ∏è Settings (sessionStorage)</h2>
        <input type="text" id="themeInput" placeholder="Theme name (e.g., dark, light)">
        <input type="text" id="usernameInput" placeholder="Username">
        <button onclick="saveSettings()">Save Settings</button>
        <button onclick="loadSettings()">Apply Settings</button>
        <div id="settingsOutput" class="output"></div>
    </div>
    
    <div class="section">
        <h2>üì® Messages (postMessage)</h2>
        <input type="text" id="messageInput" placeholder="Enter message...">
        <button onclick="sendMessage()">Send via postMessage</button>
        <div id="messageOutput" class="output"></div>
    </div>
    
    <div class="section">
        <h2>ü™ü window.name</h2>
        <input type="text" id="windowNameInput" placeholder="Set window.name...">
        <button onclick="setWindowName()">Set window.name</button>
        <button onclick="readWindowName()">Read & Display</button>
        <div id="windowNameOutput" class="output"></div>
    </div>
    
    <script>
        // ===== localStorage XSS =====
        function saveNote() {
            const note = document.getElementById('noteInput').value;
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            notes.push({
                text: note,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('notes', JSON.stringify(notes));
            alert('Note saved!');
        }
        
        function loadNotes() {
            const notes = JSON.parse(localStorage.getItem('notes') || '[]');
            let html = '<h3>Your Notes:</h3>';
            notes.forEach((note, i) => {
                // SINK 1: innerHTML with localStorage data - VULNERABLE!
                html += '<div class="note"><strong>#' + (i+1) + '</strong>: ' + note.text + '</div>';
            });
            document.getElementById('notesOutput').innerHTML = html;
        }
        
        function clearNotes() {
            localStorage.removeItem('notes');
            document.getElementById('notesOutput').innerHTML = '<p>Notes cleared.</p>';
        }
        
        // ===== sessionStorage XSS =====
        function saveSettings() {
            const theme = document.getElementById('themeInput').value;
            const username = document.getElementById('usernameInput').value;
            sessionStorage.setItem('theme', theme);
            sessionStorage.setItem('username', username);
            alert('Settings saved!');
        }
        
        function loadSettings() {
            const theme = sessionStorage.getItem('theme') || 'default';
            const username = sessionStorage.getItem('username') || 'Guest';
            
            // SINK 2: innerHTML with sessionStorage - VULNERABLE!
            document.getElementById('settingsOutput').innerHTML = 
                '<p>Theme: <strong>' + theme + '</strong></p>' +
                '<p>Welcome back, <strong>' + username + '</strong>!</p>';
        }
        
        // ===== postMessage XSS =====
        window.addEventListener('message', function(event) {
            // SINK 3: innerHTML with postMessage data - VULNERABLE!
            document.getElementById('messageOutput').innerHTML = 
                '<p>Received: ' + event.data + '</p>';
        });
        
        function sendMessage() {
            const msg = document.getElementById('messageInput').value;
            window.postMessage(msg, '*');
        }
        
        // ===== window.name XSS =====
        function setWindowName() {
            window.name = document.getElementById('windowNameInput').value;
            alert('window.name set!');
        }
        
        function readWindowName() {
            // SINK 4: innerHTML with window.name - VULNERABLE!
            document.getElementById('windowNameOutput').innerHTML = 
                '<p>window.name: <strong>' + window.name + '</strong></p>';
        }
        
        // Auto-load on page ready
        document.addEventListener('DOMContentLoaded', function() {
            loadNotes();
            loadSettings();
        });
    </script>
    
    <div class="warning">
        <h3>‚ö†Ô∏è Known Vulnerabilities:</h3>
        <ul>
            <li><strong>localStorage:</strong> Save note with XSS payload, then load</li>
            <li><strong>sessionStorage:</strong> Set username to XSS payload</li>
            <li><strong>postMessage:</strong> Send XSS via message input</li>
            <li><strong>window.name:</strong> Set to XSS payload and read</li>
        </ul>
    </div>
</body>
</html>
